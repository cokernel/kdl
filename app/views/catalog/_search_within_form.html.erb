<div id="search" class="search">
  <% form_tag catalog_index_path, :method => :get do %>
    <% label = search_within_text(document) %>
    <h2 class="search"><%= label_tag(:q, label) %></h2>
    <%= text_field_tag :q, params[:q], :class => "q" %>
    
    <%= search_as_hidden_fields(:omit_keys => [:q, :search_field, :qt, :page]) %>        

    <% search_within(document).each do |field| %>
    <input type="hidden" name="f[<%= field %>][]" value="<%= document[field] %>"/>
    <% end %>
    
    <%= submit_tag label, :class=>'submit' %>

    <%= render :partial => 'search_tips' %>
    <% if document.has_key?('cal_year') %>
    <%- cal = cal_info(document['url']) -%>
    <input type="hidden" id="datepicker" name="datepicker">
    <label for="datepicker" class="datepicker">Calendar View</label>
    <script type="text/javascript">
    $(document).ready(function() {
      Calendar.init({
        id: 'datepicker',
        <%- if document.has_key?('cal_title') -%>
        title: '<%= document['cal_title'] %>',
        <%- end -%>
        yearRange: '<%= cal['cal_year'] %>:+0Y',
        minDate: '<%= cal['cal_year'] %>-<%= cal['cal_month'] %>-01',
        year: <%= document['cal_year'] %>,
        month: <%= document['cal_month'] %>
      });
      $('.datepicker').click(function() {
        $('#datepicker').datepicker('show');
      });
    });
    </script>
    <% end %>
  <% end %>

  <hr/>
</div>
