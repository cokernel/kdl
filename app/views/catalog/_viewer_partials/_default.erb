<% unless @document.has_key?('unpaged_display') %>
<% extra_head_content << capture do %>
<script src="/javascripts/mousetrap.min.js" type="text/javascript"></script>
<script src="http://maps.google.com/maps?file=api&amp;v=2.x&amp;key=ABQIAAAANZhE12_nSwoiEeOrTR9VFRRP8KZ0B-_Pw6waNKIP-bVwSDZSmxRlrMqG5WEDK9-gF1vxqf7vMfIAyQ" type="text/javascript"></script>
<script src="/gmapviewer/resources/elabel.js" type="text/javascript"></script>
<script src="/gmapviewer/resources/dragzoom.js" type="text/javascript"></script>
<script src="/gmapviewer/resources/gmapconfig.js" type="text/javascript"></script>
<script src="/gmapviewer/resources/gmapviewer.js" type="text/javascript"></script>
<% end %>

<div id="image_viewer">
  <% if @document.has_key?('reference_image_url_s') %>
  <img class="reference_image" id="reference_image" src="<%= @document['reference_image_url_s'] %>"/>
  <% end %>
  <script type="text/javascript">
  var viewer = null;
  var elt = null;
  var fs = false;

  function fullScreen() {
    if (viewer && viewer.map && viewer.map.toggleFSControl) {
      viewer.map.savePosition();
      viewer.map.toggleFSControl();
      viewer.map.returnToSavedPosition();
    }
    else {
      setTimeout(fullScreen, 200);
    }
  }

  function fsON() {
    $.post('<%= url_for :controller => 'fs', :action => 'on' %>');
  }

  function fsOFF() {
    $.post('<%= url_for :controller => 'fs', :action => 'off' %>');
  }

  function loadViewer() {
    if (elt === null) {
      fs = false;
      jQuery('#viewer').text('');
      jQuery('#fs_viewer').addClass('onpage');
      viewer = new GMapViewer("viewer");
      viewer.setCopyright("", "");
      <% if alto_word_coordinates(@document).length > 0 %>
      viewer.wants_alto = true;
      <% end %>
      <% if @document.has_key?('viewer_url_s') %>
      viewer.loadImage("<%= @document['viewer_url_s'] %>");
      <% end %>
      <%= alto_word_coordinates(@document) %>
      <% if full_screen %>
      fullScreen();
      <% end %>
      jQuery('#reference_image').hide();

    }
  }

  jQuery(document).ready(function() {
    loadViewer();
  });
  </script>
  <div id="fs_viewer">
  <!-- pagination -->
  <div class="fs_pagination hidden">
    <%= render 'pagination' %>
  </div>
  <div id="viewer">test</div>
  </div>
</div>
<% else %>
  <% extra_head_content << capture do %>
    <link rel="stylesheet" type="text/css" href="/stylesheets/oh.css" media="all">
  <% end %>
  <% if @document.has_key?('synchronization_url_s') %>
    <p class="oh_link">
    <%= link_to image_tag('/images/play.png', :id => 'viewer_play_button', :alt => 'Play oral history', :title => 'Play oral history'), oh_url(@document) %>
    </p>
  <% end %>
<% end %>
